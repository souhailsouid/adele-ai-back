### REST Client pour VS Code
### Extension: REST Client (humao.rest-client)
### 
### Variables d'environnement (√† d√©finir dans VS Code settings ou dans ce fichier)
### 
### IMPORTANT : Apr√®s le d√©ploiement de la s√©paration des API Gateways, il y a maintenant 2 URLs :
### - @baseUrlMain : API Gateway 1 (routes de l'application principale)
### - @baseUrlData : API Gateway 2 (routes de donn√©es brutes FMP + UW)
### 
### Pour obtenir les URLs apr√®s terraform apply :
###   terraform output api_gateway_url        # API Gateway 1
###   terraform output api_data_gateway_url  # API Gateway 2

### API Gateway 1 : Application Principale (signals, funds, companies, analysis, scoring, etc.)
@baseUrlMain = https://tsdd1sibd1.execute-api.eu-west-3.amazonaws.com/prod

### API Gateway 2 : Donn√©es Brutes (FMP + Unusual Whales)
### ‚ö†Ô∏è √Ä mettre √† jour apr√®s terraform apply avec : terraform output api_data_gateway_url
@baseUrlData = https://faq9dl95v7.execute-api.eu-west-3.amazonaws.com/prod

### Token d'acc√®s (√† mettre √† jour r√©guli√®rement)
@accessToken = eyJraWQiOiIwekpSMTVhYjBqSk0xdnJmaFBSa0NveGJBaHhnXC9HblhkeU56Y09iRkRyND0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI1MTI5ODBiZS0wMGQxLTcwZmYtNTQ3Zi0zYTA3YzkyMzA3ODIiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0zLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtM19GUURtaHhWMTQiLCJjbGllbnRfaWQiOiJwa3A0aTgyam50dHRoajJjYmlsdHVkZ3ZhIiwib3JpZ2luX2p0aSI6ImJlZWIyYWMzLWQ2ZDEtNGVlNi04ZjkyLTFmNWVhMGQ3NmU2YyIsImV2ZW50X2lkIjoiZTQzODVjNDYtYjNhOC00MjRjLTgzYjItYzRiMmU5MmZkZjU1IiwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJhd3MuY29nbml0by5zaWduaW4udXNlci5hZG1pbiIsImF1dGhfdGltZSI6MTc2NzEwMTM3MiwiZXhwIjoxNzY3MTA0OTcyLCJpYXQiOjE3NjcxMDEzNzIsImp0aSI6IjljNTA4YjNiLTZlZmYtNGU0YS05ODFhLTZmNDVhZThjMjZmYSIsInVzZXJuYW1lIjoiNTEyOTgwYmUtMDBkMS03MGZmLTU0N2YtM2EwN2M5MjMwNzgyIn0.rLnzJyE50724XzkXPPEB-Sht5FYymXU5lLV_s9qcyrBREctpsY7P5bMwwj5IonEp39MFQshnN-aSXbw_Mnkm9s5jqjt-W-81GAlf54Sy31JzJTaOTJTncWIiIBs-ZY0_NLhtpitlcKkw2yEAJHjj4XOTZRsFQckcbZVBrRBIGEKB2NJ5-WzjcD0RuVdXKP3AOjTfCZvtEcSIigfMnUgnTOc5rpPzLnRArdF5vi1Qj_orYy1x5Zl4bZ0fonDSo6N-oYi_-FuXytVpK9gDhJ7QFE-GyvdL3xoZ7RUbRWan_8eW-Z8fwYQ79SKOh9ijsywXg4BQnD2qtZSLWeT1q65XUg
/fmp/insider-trading/latest@watchId = ff9dcbd4-1e0a-4e48-8604-854cdb5ac407"
### ============================================
### ANALYSE COMBIN√âE (FMP + UW)
### ============================================

### Complete Analysis - Analyse compl√®te (fundamentals + sentiment)
### ‚úÖ API Gateway 1 (Application Principale)
GET {{baseUrlMain}}/analysis/AAPL/complete
Authorization: Bearer {{accessToken}}

### Complete Analysis - TSLA
GET {{baseUrlMain}}/analysis/TSLA/complete
Authorization: Bearer {{accessToken}}

### Complete Analysis - NVDA
GET {{baseUrlMain}}/analysis/NVDA/complete
Authorization: Bearer {{accessToken}}

### Divergence Analysis - D√©tecte les divergences fundamentals vs sentiment
GET {{baseUrlMain}}/analysis/AAPL/divergence
Authorization: Bearer {{accessToken}}

### Divergence Analysis - NVDA
GET {{baseUrlMain}}/analysis/NVDA/divergence
Authorization: Bearer {{accessToken}}

### Comprehensive Valuation - Valuation compl√®te (DCF + Sentiment Multiplier)
GET {{baseUrlMain}}/analysis/AAPL/valuation
Authorization: Bearer {{accessToken}}

### Comprehensive Valuation - MSFT
GET {{baseUrlMain}}/analysis/MSFT/valuation
Authorization: Bearer {{accessToken}}

### Earnings Prediction - Pr√©diction de surprise d'earnings
GET {{baseUrlMain}}/analysis/AAPL/earnings-prediction
Authorization: Bearer {{accessToken}}

### Earnings Prediction - Avec date sp√©cifique
GET {{baseUrlMain}}/analysis/AAPL/earnings-prediction?earningsDate=2025-01-30
Authorization: Bearer {{accessToken}}

### Earnings Prediction - TSLA
GET {{baseUrlMain}}/analysis/TSLA/earnings-prediction
Authorization: Bearer {{accessToken}}

### Risk Analysis - Analyse de risque (financier + march√©)
GET {{baseUrlMain}}/analysis/AAPL/risk
Authorization: Bearer {{accessToken}}

### Risk Analysis - TSLA
GET {{baseUrlMain}}/analysis/TSLA/risk
Authorization: Bearer {{accessToken}}

### Risk Analysis - NVDA
GET {{baseUrlMain}}/analysis/NVDA/risk
Authorization: Bearer {{accessToken}}

### ============================================
### SCREENER MULTI-CRIT√àRES
### ============================================

### Multi-Criteria Screener - Screening avec crit√®res FMP + UW
### ‚úÖ API Gateway 1 (Application Principale)
POST {{baseUrlMain}}/screener/multi-criteria
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "minMarketCap": 1000000000,
  "maxPERatio": 30,
  "minRevenueGrowth": 5,
  "limit": 10
}

### Multi-Criteria Screener - Technology sector
POST {{baseUrlMain}}/screener/multi-criteria
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "sector": "Technology",
  "minMarketCap": 10000000000,
  "maxPERatio": 25,
  "limit": 5
}

### ============================================
### INSTITUTION TRACKING
### ============================================

### Institution Tracking - Berkshire Hathaway
### ‚úÖ API Gateway 1 (Application Principale)
GET {{baseUrlMain}}/institutions/Berkshire%20Hathaway/tracking
Authorization: Bearer {{accessToken}}

### Institution Tracking - BlackRock
GET {{baseUrlMain}}/institutions/BlackRock/tracking
Authorization: Bearer {{accessToken}}

### Institution Tracking - Vanguard
GET {{baseUrlMain}}/institutions/Vanguard/tracking
Authorization: Bearer {{accessToken}}

### ============================================
### SECTOR ANALYSIS
### ============================================

### Sector Analysis - Technology
### ‚úÖ API Gateway 1 (Application Principale)
GET {{baseUrlMain}}/analysis/sector/Technology
Authorization: Bearer {{accessToken}}

### Sector Analysis - Healthcare
GET {{baseUrlMain}}/analysis/sector/Healthcare
Authorization: Bearer {{accessToken}}

### Sector Analysis - Financial
GET {{baseUrlMain}}/analysis/sector/Financial
Authorization: Bearer {{accessToken}}

### ============================================
### UNUSUAL WHALES - Endpoints de donn√©es brutes
### ============================================
### ‚ö†Ô∏è API Gateway 2 (Donn√©es Brutes) - Mettre √† jour @baseUrlData apr√®s terraform apply
### ‚ú® NOUVEAU : Cache int√©gr√© dans le service UW
### Les m√©thodes suivantes utilisent maintenant le cache automatiquement :
### - getRecentFlows ‚Üí stocke dans options_flow (TTL: 1h)
### - getDarkPoolTrades ‚Üí stocke dans dark_pool_trades (TTL: 24h)
### - getShortInterestAndFloat ‚Üí stocke dans short_interest (TTL: 24h)

### Recent Flows - Flow d'options r√©cent
### ‚ú® Cache : V√©rifie automatiquement options_flow avant d'appeler l'API
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-recent?limit=10
Authorization: Bearer {{accessToken}}

### Recent Flows - TSLA
GET {{baseUrlData}}/unusual-whales/stock/TSLA/flow-recent?limit=10&min_premium=50000
Authorization: Bearer {{accessToken}}

### Recent Flows - NVDA (test cache int√©gr√©)
GET {{baseUrlData}}/unusual-whales/stock/NVDA/flow-recent?limit=30
Authorization: Bearer {{accessToken}}

### Institution Ownership - Propri√©t√© institutionnelle
GET {{baseUrlData}}/unusual-whales/institution/AAPL/ownership
Authorization: Bearer {{accessToken}}

### Short Interest and Float - Int√©r√™t √† d√©couvert
### ‚ú® Cache : V√©rifie automatiquement short_interest avant d'appeler l'API
GET {{baseUrlData}}/unusual-whales/shorts/AAPL/interest-float
Authorization: Bearer {{accessToken}}

### Short Interest and Float - NVDA (test cache int√©gr√©)
GET {{baseUrlData}}/unusual-whales/shorts/NVDA/interest-float
Authorization: Bearer {{accessToken}}

### Short Interest and Float - TSLA (test cache int√©gr√©)
GET {{baseUrlData}}/unusual-whales/shorts/TSLA/interest-float
Authorization: Bearer {{accessToken}}

### Dark Pool Trades - Transactions dark pool
### ‚ú® Cache : V√©rifie automatiquement dark_pool_trades avant d'appeler l'API
GET {{baseUrlData}}/unusual-whales/dark-pool/AAPL?limit=50
Authorization: Bearer {{accessToken}}

### Dark Pool Trades - NVDA (test cache int√©gr√©)
GET {{baseUrlData}}/unusual-whales/dark-pool/NVDA?limit=30
Authorization: Bearer {{accessToken}}

### Insider Buy/Sells - Transactions d'insiders
GET {{baseUrlData}}/unusual-whales/stock/AAPL/insider-buy-sells
Authorization: Bearer {{accessToken}}

### Institution Activity - Activit√© institutionnelle
GET {{baseUrlData}}/unusual-whales/institution/AAPL/activity?limit=100
Authorization: Bearer {{accessToken}}

### ============================================
### FMP - Endpoints de donn√©es brutes
### ============================================
### ‚ö†Ô∏è API Gateway 2 (Donn√©es Brutes) - Mettre √† jour @baseUrlData apr√®s terraform apply

### Stock Quote - Cotation
GET {{baseUrlData}}/fmp/quote/AAPL
Authorization: Bearer {{accessToken}}

### Income Statement - √âtat des r√©sultats
GET {{baseUrlData}}/fmp/income-statement/AAPL?limit=5&period=annual
Authorization: Bearer {{accessToken}}

### Financial Ratios - Ratios financiers
GET {{baseUrlData}}/fmp/financial-ratios/AAPL?limit=5
Authorization: Bearer {{accessToken}}

### Key Metrics - M√©triques cl√©s
GET {{baseUrlData}}/fmp/key-metrics/AAPL?limit=5
Authorization: Bearer {{accessToken}}

### Balance Sheet - Bilan
GET {{baseUrlData}}/fmp/balance-sheet-statement/AAPL?limit=1
Authorization: Bearer {{accessToken}}

### Cash Flow Statement - √âtat des flux de tr√©sorerie
GET {{baseUrlData}}/fmp/cash-flow-statement/AAPL?limit=1
Authorization: Bearer {{accessToken}}

### DCF Valuation - Valorisation DCF
GET {{baseUrlData}}/fmp/dcf-valuation/AAPL
Authorization: Bearer {{accessToken}}

### Levered DCF - DCF avec effet de levier
GET {{baseUrlData}}/fmp/levered-dcf/AAPL
Authorization: Bearer {{accessToken}}

### Earnings Report - Rapport de r√©sultats
GET {{baseUrlData}}/fmp/earnings/AAPL
Authorization: Bearer {{accessToken}}

### Financial Estimates - Estimations financi√®res
GET {{baseUrlData}}/fmp/financial-estimates/AAPL?period=quarter
Authorization: Bearer {{accessToken}}

### Ratings Snapshot - Aper√ßu des notations
GET {{baseUrlData}}/fmp/ratings-snapshot/AAPL
Authorization: Bearer {{accessToken}}

### ============================================
### TICKER ACTIVITY (Legacy)
### ============================================
### ‚úÖ API Gateway 1 (Application Principale)

### Ticker Quote - Cotation
GET {{baseUrlMain}}/ticker-activity/AAPL/quote
Authorization: Bearer {{accessToken}}

### Ticker Activity - Activit√©
GET {{baseUrlMain}}/ticker-activity/AAPL/activity
Authorization: Bearer {{accessToken}}

### Ticker Options - Options
GET {{baseUrlMain}}/ticker-activity/AAPL/options?limit=10
Authorization: Bearer {{accessToken}}
### Ticker Options - Options
GET {{baseUrlMain}}/ticker-activity/NVDA/options?limit=10
Authorization: Bearer {{accessToken}}
### Ticker Dark Pool - Dark pool
GET {{baseUrlMain}}/ticker-activity/AAPL/dark-pool?limit=10
Authorization: Bearer {{accessToken}}

### Ticker Insights - Insights complets
GET {{baseUrlMain}}/ticker-insights/AAPL
Authorization: Bearer {{accessToken}}

### ============================================
### TESTS DE VALIDATION DES DONN√âES
### ============================================

### Test 1: V√©rifier que Recent Flows retourne des donn√©es (API Gateway 2)
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-recent?limit=10
Authorization: Bearer {{accessToken}}

### Test 2: V√©rifier que Institution Ownership retourne des donn√©es (API Gateway 2)
GET {{baseUrlData}}/unusual-whales/institution/AAPL/ownership
Authorization: Bearer {{accessToken}}

### Test 3: V√©rifier que Short Interest retourne des donn√©es (API Gateway 2)
GET {{baseUrlData}}/unusual-whales/shorts/AAPL/interest-float
Authorization: Bearer {{accessToken}}

### Test 4: V√©rifier que Dark Pool retourne des donn√©es (API Gateway 2)
GET {{baseUrlData}}/unusual-whales/dark-pool/AAPL?limit=10
Authorization: Bearer {{accessToken}}

### Test 5: V√©rifier que Complete Analysis utilise les donn√©es UW (API Gateway 1)
GET {{baseUrlMain}}/analysis/AAPL/complete
Authorization: Bearer {{accessToken}}

### Test 6: V√©rifier que Valuation a un prix actuel valide (API Gateway 1)
GET {{baseUrlMain}}/analysis/AAPL/valuation
Authorization: Bearer {{accessToken}}

### Test 7: V√©rifier que Earnings Prediction a des signaux valides (API Gateway 1)
GET {{baseUrlMain}}/analysis/AAPL/earnings-prediction
Authorization: Bearer {{accessToken}}

### Test 8: V√©rifier que Score retourne des donn√©es (API Gateway 1)
GET {{baseUrlMain}}/ticker-analysis/AAPL/score 
Authorization: Bearer {{accessToken}}

### Test 9: V√©rifier que Breakdown retourne des donn√©es (API Gateway 1)
GET {{baseUrlMain}}/ticker-analysis/AAPL/breakdown
Authorization: Bearer {{accessToken}}

### Test 10: V√©rifier que Institution Tracking retourne des donn√©es (API Gateway 1)
GET {{baseUrlMain}}/institutions/Berkshire%20Hathaway/tracking
Authorization: Bearer {{accessToken}}

### Test 11: V√©rifier que Gamma Squeeze retourne des donn√©es (API Gateway 1)
GET {{baseUrlMain}}/ticker-analysis/TSLA/gamma-squeeze
Authorization: Bearer {{accessToken}}

### ============================================
### SURVEILLANCE - Phase 2
### ============================================
### ‚úÖ API Gateway 1 (Application Principale)

### Cr√©er une surveillance pour un ticker
POST {{baseUrlMain}}/surveillance/watch
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "AAPL",
  "minPremium": 50000,
  "callVolumeThreshold": 1000000,
  "putVolumeThreshold": 500000,
  "darkPoolVolumeThreshold": 5000000,
  "shortInterestThreshold": 20,
  "insiderChangeThreshold": 10,
  "checkInterval": 5,
  "notificationChannels": ["webhook", "email"],
  "active": true
}

### Cr√©er une surveillance pour TSLA
POST {{baseUrlMain}}/surveillance/watch
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA",
  "minPremium": 100000,
  "callVolumeThreshold": 2000000,
  "shortInterestThreshold": 15,
  "checkInterval": 5,
  "notificationChannels": ["webhook"]
}

### Liste des surveillances de l'utilisateur
GET {{baseUrlMain}}/surveillance/watches
Authorization: Bearer {{accessToken}}

### R√©cup√©rer les alertes d'une surveillance (remplacer {id} par un watchId r√©el)
GET {{baseUrlMain}}/surveillance/watch/b3723b7c-215d-49cf-ad63-0e160d5b80b5/alerts
Authorization: Bearer {{accessToken}}

### D√©clencher manuellement la v√©rification d'une surveillance (pour g√©n√©rer des alertes)
POST {{baseUrlMain}}/surveillance/watch/b3723b7c-215d-49cf-ad63-0e160d5b80b5/check
Authorization: Bearer {{accessToken}}

### Supprimer une surveillance (remplacer {id} par un watchId r√©el)
DELETE {{baseUrlMain}}/surveillance/watch/89acab7a-109f-4ff5-8cc4-e5e6ddacb820
Authorization: Bearer {{accessToken}}

### ============================================
### ALERTES MULTI-SIGNAUX - Phase 2
### ============================================
### ‚úÖ API Gateway 1 (Application Principale)

### Cr√©er une alerte multi-signaux (AND)
POST {{baseUrlMain}}/alerts
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "AAPL",
  "name": "Alerte Options Flow + Insiders",
  "description": "D√©clenche si options flow √©lev√© ET insiders ach√®tent",
  "conditions": [
    {
      "signal": "options_flow",
      "operator": "gt",
      "value": 1000000,
      "params": {
        "type": "call"
      }
    },
    {
      "signal": "insider_activity",
      "operator": "gt",
      "value": 2
    }
  ],
  "logic": "AND",
  "notificationChannels": ["webhook", "email"],
  "active": true
}

### Cr√©er une alerte multi-signaux (OR)
POST {{baseUrlMain}}/alerts
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA",
  "name": "Alerte Dark Pool OU Short Interest",
  "description": "D√©clenche si dark pool √©lev√© OU short interest √©lev√©",
  "conditions": [
    {
      "signal": "dark_pool",
      "operator": "gt",
      "value": 5000000
    },
    {
      "signal": "short_interest",
      "operator": "gt",
      "value": 20
    }
  ],
  "logic": "OR",
  "notificationChannels": ["webhook"],
  "active": true
}

### Liste des alertes de l'utilisateur
GET {{baseUrlMain}}/alerts
Authorization: Bearer {{accessToken}}

### R√©cup√©rer une alerte par ID (remplacer {id} par un alertId r√©el)
GET {{baseUrlMain}}/alerts/{id}
Authorization: Bearer {{accessToken}}

### Mettre √† jour une alerte (remplacer {id} par un alertId r√©el)
PUT {{baseUrlMain}}/alerts/{id}
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Alerte mise √† jour",
  "active": false
}

### Tester une alerte (v√©rifier si elle se d√©clencherait maintenant)
POST {{baseUrlMain}}/alerts/{id}/test
Authorization: Bearer {{accessToken}}

### Supprimer une alerte (remplacer {id} par un alertId r√©el)
DELETE {{baseUrlMain}}/alerts/{id}
Authorization: Bearer {{accessToken}}

### ============================================
### SMART MONEY - Phase 3 (Compl√©t√©)
### ============================================
### ‚úÖ API Gateway 1 (Application Principale)

### Top Hedge Funds par performance (d√©faut: 3 mois)
GET {{baseUrlMain}}/smart-money/top-hedge-funds
Authorization: Bearer {{accessToken}}

### Top Hedge Funds - P√©riode 1 mois
GET {{baseUrlMain}}/smart-money/top-hedge-funds?period=1M
Authorization: Bearer {{accessToken}}

### Top Hedge Funds - P√©riode 3 mois
GET {{baseUrlMain}}/smart-money/top-hedge-funds?period=3M
Authorization: Bearer {{accessToken}}

### Top Hedge Funds - P√©riode 6 mois
GET {{baseUrlMain}}/smart-money/top-hedge-funds?period=6M
Authorization: Bearer {{accessToken}}

### Top Hedge Funds - P√©riode 1 an
GET {{baseUrlMain}}/smart-money/top-hedge-funds?period=1Y
Authorization: Bearer {{accessToken}}

### Copy Trades - Berkshire Hathaway pour AAPL (par nom - peut ne pas fonctionner)
GET {{baseUrlMain}}/smart-money/institution/Berkshire%20Hathaway/copy-trades/AAPL
Authorization: Bearer {{accessToken}}

### Copy Trades - Berkshire Hathaway pour TSLA (par CIK - fonctionne)
### CIK: 0001697748 (Berkshire Hathaway)
GET {{baseUrlMain}}/smart-money/institution/0001697748/copy-trades/TSLA
Authorization: Bearer {{accessToken}}

### Copy Trades - BlackRock pour TSLA (par CIK)
### CIK: 0001364742 (BlackRock)
GET {{baseUrlMain}}/smart-money/institution/0001364742/copy-trades/TSLA
Authorization: Bearer {{accessToken}}

### Copy Trades - Vanguard pour MSFT
GET {{baseUrlMain}}/smart-money/institution/Vanguard/copy-trades/MSFT
Authorization: Bearer {{accessToken}}

### Copy Trades - Fidelity pour NVDA
GET {{baseUrlMain}}/smart-money/institution/Fidelity/copy-trades/NVDA
Authorization: Bearer {{accessToken}}

### ============================================
### MARKET ANALYSIS - Phase 4 (Compl√©t√©)
### ============================================
### ‚úÖ API Gateway 1 (Application Principale)

### Sector Rotation - D√©tection des rotations sectorielles
GET {{baseUrlMain}}/market-analysis/sector-rotation
Authorization: Bearer {{accessToken}}

### Market Tide - Sentiment global du march√©
GET {{baseUrlMain}}/market-analysis/market-tide
Authorization: Bearer {{accessToken}}

### ============================================
### TESTS COMPL√âMENTAIRES - Services compl√©t√©s
### ============================================

### Test 12: V√©rifier que Top Hedge Funds retourne des donn√©es
GET {{baseUrlMain}}/smart-money/top-hedge-funds
Authorization: Bearer {{accessToken}}

### Test 13: V√©rifier que Copy Trades retourne des donn√©es (par CIK)
GET {{baseUrlMain}}/smart-money/institution/0001649339/copy-trades/TSLA
Authorization: Bearer {{accessToken}}

### Test 14: V√©rifier que Sector Rotation retourne des donn√©es
GET {{baseUrlMain}}/market-analysis/sector-rotation
Authorization: Bearer {{accessToken}}

### Test 15: V√©rifier que Market Tide retourne des donn√©es
GET {{baseUrlMain}}/market-analysis/market-tide
Authorization: Bearer {{accessToken}}

### TEST 16: CALENDAR

GET https://tsdd1sibd1.execute-api.eu-west-3.amazonaws.com/prod/economic-calendar?from=2025-12-07&to=2026-01-06
Authorization: Bearer {{accessToken}}

### Test 17: V√©rifier que 13F Filings retourne des donn√©es
GET {{baseUrlMain}}/13f-filings/latest
Authorization: Bearer {{accessToken}}

### Test 17b: 13F Filings avec p√©riode sp√©cifique
GET {{baseUrlMain}}/13f-filings/latest?from=2025-09-07&to=2025-12-07&limit=50
Authorization: Bearer {{accessToken}}

### Test 18: V√©rifier que 13F Filings retourne des donn√©es avec des param√®tres

POST {{baseUrlMain}}/attribution/flow
Authorization: Bearer {{accessToken}}

### Test 19: V√©rifier que Attribution Institution retourne des donn√©es
GET {{baseUrlMain}}/attribution/institution/{institutionId}/ticker/{ticker} ‚Äî Attribuer l'influence d'une institution
Authorization: Bearer {{accessToken}}


### Test 20: V√©rifier que Attribution Dominant Entities retourne des donn√©es
GET {{baseUrlMain}}/attribution/dominant-entities/{ticker} ‚Äî Trouver les entit√©s dominantes
Authorization: Bearer {{accessToken}}

### Test 20: V√©rifier que Attribution Clusters retourne des donn√©es
GET {{baseUrlMain}}/attribution/clusters 
Authorization: Bearer {{accessToken}}

### Test 21: Attribution Clusters avec secteur sp√©cifique
GET {{baseUrlMain}}/attribution/clusters?sector=Technology
Authorization: Bearer {{accessToken}}

### ============================================
### 13F FILINGS - Transactions et Holdings
### ============================================
### ‚ö†Ô∏è API Gateway 2 (Donn√©es Brutes) - Mettre √† jour @baseUrlData apr√®s terraform apply

### Holdings d'une Institution (BlackRock) - Visualiser les transactions
### CIK: 0001364742 (BlackRock)
GET {{baseUrlData}}/unusual-whales/institution/0001364742/holdings?date=2025-09-30&limit=100&order=value&order_direction=desc
Authorization: Bearer {{accessToken}}

### Holdings d'une Institution (Vanguard) - Visualiser les transactions
### CIK: 0000102909 (Vanguard)
GET {{baseUrlData}}/unusual-whales/institution/0000102909/holdings?date=2025-09-30&limit=100&order=units_change&order_direction=desc
Authorization: Bearer {{accessToken}}

### Holdings d'une Institution avec p√©riode (comparaison)
### Permet de comparer les positions entre deux dates
GET {{baseUrlData}}/unusual-whales/institution/0001364742/holdings?start_date=2025-06-30&end_date=2025-09-30&limit=100&order=units_change&order_direction=desc
Authorization: Bearer {{accessToken}}

### Activit√© de Trading d'une Institution (BlackRock)
### Retourne les activit√©s r√©centes avec buy_price, sell_price
GET {{baseUrlData}}/unusual-whales/institution/0001364742/activity?limit=100&date=2025-09-30
Authorization: Bearer {{accessToken}}

### Activit√© de Trading d'une Institution (Berkshire Hathaway)
### CIK: 0001697748 (Berkshire Hathaway)
GET {{baseUrlData}}/unusual-whales/institution/0001697748/activity?limit=100&date=2025-09-30
Authorization: Bearer {{accessToken}}

### insider trading latest
GET {{baseUrlData}}/unusual-whales/stock/TSLA/insider-trading/latest
Authorization: Bearer {{accessToken}}
### insider trading ticker 
GET {{baseUrlData}}/unusual-whales/insider/TSLA
Authorization: Bearer {{accessToken}}
### insider transactions
GET {{baseUrlData}}/unusual-whales/insider/transactions?ticker_symbol=TSLA
Authorization: Bearer {{accessToken}}
### ticker-flow
GET {{baseUrlData}}/unusual-whales/insider/TSLA/ticker-flow
Authorization: Bearer {{accessToken}}

### api/darkpool/
GET {{baseUrlData}}/unusual-whales/dark-pool/TSLA?limit=30
Authorization: Bearer {{accessToken}}
### dark pool recent
GET {{baseUrlData}}/unusual-whales/dark-pool/recent
Authorization: Bearer {{accessToken}}
### ============================================
### HEATMAP OPTIONS - Strike √ó Expiration
### ============================================

### Options Flow (50 flows r√©cents pour heatmap)
### √Ä agr√©ger c√¥t√© frontend par strike et expiry
GET {{baseUrlMain}}/ticker-activity/AAPL/options?limit=50&min_premium=10000
Authorization: Bearer {{accessToken}}

### Options Flow (NVDA - 50 flows pour heatmap)
GET {{baseUrlMain}}/ticker-activity/NVDA/options?limit=50&min_premium=50000
Authorization: Bearer {{accessToken}}

### Flow par Strike (agr√©g√© - 1D heatmap)
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-per-strike?date=2025-12-07
Authorization: Bearer {{accessToken}}

### Flow par Expiry (agr√©g√© - 1D heatmap)
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-per-expiry
Authorization: Bearer {{accessToken}}

### Flow per Strike Intraday (avec filtre)
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-per-strike-intraday?date=2025-12-07&filter=NetPremium
Authorization: Bearer {{accessToken}}

### ============================================
### ATTRIBUTION ENGINE - Fonctionnalit√©s Avanc√©es Arkham-Level
### ============================================
### ‚úÖ API Gateway 1 (Application Principale)

### Test Flow Signature Matching (int√©gr√© dans /attribution/flow)
### Ce flow devrait maintenant matcher avec les patterns historiques de JPMorgan
POST {{baseUrlMain}}/attribution/flow
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA",
  "flowType": "CALL",
  "premium": 2000000,
  "strike": 550,
  "expiry": "2026-01-15",
  "timestamp": "2025-12-07T10:00:00Z"
}

### Test Flow Signature Matching - PUT flow
POST {{baseUrlMain}}/attribution/flow
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA",
  "flowType": "PUT",
  "premium": 1500000,
  "strike": 250,
  "expiry": "2026-02-20",
  "timestamp": "2025-12-07T10:00:00Z"
}

### Test Insider Registry (int√©gr√© dans /attribution/flow)
### Les insiders devraient maintenant √™tre enrichis avec leur r√¥le (CEO, CFO, etc.)
POST {{baseUrlMain}}/attribution/flow
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "AAPL",
  "flowType": "CALL",
  "premium": 1000000,
  "strike": 200,
  "expiry": "2026-01-20",
  "timestamp": "2025-12-07T10:00:00Z"
}

### Test Centralit√© Avanc√©e (int√©gr√© dans /attribution/institution)
### Les m√©triques devraient maintenant inclure PageRank, Betweenness, etc.
GET {{baseUrlMain}}/attribution/institution/0001364742/ticker/NVDA?period=3M
Authorization: Bearer {{accessToken}}

### Test Centralit√© Avanc√©e - BlackRock pour AAPL
GET {{baseUrlMain}}/attribution/institution/0001364742/ticker/AAPL?period=3M
Authorization: Bearer {{accessToken}}

### Test Dominant Entities avec nouvelles fonctionnalit√©s
### Devrait maintenant inclure : flotShare, positionDelta, accumulationTempo, graphCentrality
GET {{baseUrlMain}}/attribution/dominant-entities/NVDA
Authorization: Bearer {{accessToken}}

### Test Dominant Entities - TSLA
GET {{baseUrlMain}}/attribution/dominant-entities/TSLA
Authorization: Bearer {{accessToken}}

### Test Dominant Entities - AAPL
GET {{baseUrlMain}}/attribution/dominant-entities/AAPL
Authorization: Bearer {{accessToken}}

### Test Conflict Engine (int√©gr√© dans /attribution/flow)
### Devrait d√©tecter les entit√©s oppos√©es (short interest, PUT flows, dark pool bearish)
POST {{baseUrlMain}}/attribution/flow
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA",
  "flowType": "CALL",
  "premium": 3000000,
  "strike": 500,
  "expiry": "2026-01-15",
  "timestamp": "2025-12-07T10:00:00Z"
}

### Test Sector Clustering (via /attribution/clusters)
### Devrait d√©tecter les clusters d'institutions par secteur
GET {{baseUrlMain}}/attribution/clusters?sector=Technology
Authorization: Bearer {{accessToken}}

### Test Sector Clustering - Healthcare
GET {{baseUrlMain}}/attribution/clusters?sector=Healthcare
Authorization: Bearer {{accessToken}}

### Test Sector Clustering - Tous secteurs
GET {{baseUrlMain}}/attribution/clusters
Authorization: Bearer {{accessToken}}

### test 2
GET {{baseUrlData}}/unusual-whales/institution/0001103887/holdings
Authorization: Bearer {{accessToken}}
##
### ============================================
### ‚ú® CACHE INT√âGR√â - NOUVEAU SYST√àME
### ============================================
### Le cache est maintenant int√©gr√© directement dans le service UW
### 
### M√©thodes avec cache automatique :
### - getRecentFlows() ‚Üí Cache dans options_flow (TTL: 1h)
### - getDarkPoolTrades() ‚Üí Cache dans dark_pool_trades (TTL: 24h)
### - getShortInterestAndFloat() ‚Üí Cache dans short_interest (TTL: 24h)
###
### Avantages :
### - Cache transparent : toutes les routes b√©n√©ficient automatiquement du cache
### - Stockage dans Supabase : options_flow, dark_pool_trades, short_interest
### - V√©rification de fra√Æcheur : bas√©e sur data_date ou cached_at
### - Marqueurs vides : TTL r√©duit √† 15 min pour √©viter les refetch inutiles
###
### Comment tester :
### 1. Faire une premi√®re requ√™te ‚Üí devrait appeler l'API et stocker dans Supabase
### 2. Faire une deuxi√®me requ√™te imm√©diatement ‚Üí devrait utiliser le cache (cached: true)
### 3. V√©rifier dans les logs CloudWatch : "Using cached..." vs "Fetching fresh..."
###
### Voir section "TESTS CACHE INT√âGR√â" pour des tests d√©taill√©s

### ============================================
### NOTES
### ============================================
###
### üîÄ S√âPARATION DES API GATEWAYS
### Apr√®s le d√©ploiement, il y a maintenant 2 API Gateways :
### 
### 1. API Gateway 1 (@baseUrlMain) : Routes de l'application principale
###    - /signals, /funds, /companies
###    - /ticker-activity/*, /ticker-insights/*
###    - /analysis/*, /screener/*, /institutions/*
###    - /ticker-analysis/* (score, breakdown, gamma-squeeze)
###    - /surveillance/* (surveillance continue)
###    - /alerts/* (alertes multi-signaux)
###    - /smart-money/* (top hedge funds, copy trades)
###    - /market-analysis/* (sector rotation, market tide)
###
### 2. API Gateway 2 (@baseUrlData) : Routes de donn√©es brutes
###    - /fmp/* (toutes les routes FMP)
###    - /unusual-whales/* (toutes les routes UW)
###
### üìù INSTRUCTIONS
###
### 1. Apr√®s terraform apply, r√©cup√©rez les URLs :
###    cd infra/terraform
###    terraform output api_gateway_url        # ‚Üí Mettre dans @baseUrlMain
###    terraform output api_data_gateway_url  # ‚Üí Mettre dans @baseUrlData
###
### 2. Remplacez {{accessToken}} par votre token d'acc√®s valide
### 3. Le token expire apr√®s un certain temps, r√©g√©n√©rez-le si n√©cessaire
###
### 4. Pour utiliser des variables d'environnement dans VS Code:
###    - Ouvrez les settings (Cmd/Ctrl + ,)
###    - Cherchez "rest-client.environmentVariables"
###    - Ajoutez vos variables
###
### 5. Pour tester un endpoint:
###    - Cliquez sur "Send Request" au-dessus de la requ√™te
###    - Ou utilisez Cmd/Ctrl + Alt + R
###
### 6. Les r√©ponses s'affichent dans un onglet √† droite
###
### 7. Valeurs suspectes √† surveiller:
###    - sentiment.score = 50 (valeur par d√©faut)
###    - callVolume = 0 et putVolume = 0 (pas de donn√©es options)
###    - currentPrice = 0 (prix non extrait)
###    - totalHoldings = 0 (pas de holdings)
###    - averagePE = 0 (PE non calcul√©)
###
### ============================================
### ATTRIBUTION ENGINE
### ============================================

### Test connexion Neo4j
GET {{baseUrlMain}}/graph/test-connection
Authorization: Bearer {{accessToken}}

### 
GET {{baseUrlData}}/unusual-whales/institution/0001103887/holdings?date=2025-12-05&limit=100&order=value&order_direction=desc
Authorization: Bearer {{accessToken}}
###

### Attribuer un flow options √† des entit√©s
POST {{baseUrlMain}}/attribution/flow
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA",
  "flowType": "CALL",
  "premium": 2000000,
  "strike": 500,
  "expiry": "2026-01-15",
  "timestamp": "2025-12-07T10:00:00Z"
}

###

### Attribuer l'influence d'une institution sur un ticker
GET {{baseUrlMain}}/attribution/institution/0001364742/ticker/NVDA?period=3M
Authorization: Bearer {{accessToken}}

###
### UW MARKET - Top Net Impact
### R√©cup√®re les tickers avec le plus grand impact net (options flow)
GET {{baseUrlData}}/unusual-whales/market/top-net-impact?limit=1000
Authorization: Bearer {{accessToken}}

### Top Net Impact avec date sp√©cifique
GET {{baseUrlData}}/unusual-whales/market/top-net-impact?date=2025-12-09&limit=50
Authorization: Bearer {{accessToken}}

### Top Net Impact - Top 20
GET {{baseUrlData}}/unusual-whales/market/top-net-impact?limit=20
Authorization: Bearer {{accessToken}}

###
### UW ECONOMIC-CALENDAR 
GET {{baseUrlData}}/unusual-whales/market/economic-calendar?limit=500
Authorization: Bearer {{accessToken}}

### Analyse IA du calendrier √©conomique Unusual Whales
POST {{baseUrlMain}}/ai/economic-calendar-analysis?limit=500
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Trouver les entit√©s dominantes pour un ticker
GET {{baseUrlMain}}/attribution/dominant-entities/NVDA
Authorization: Bearer {{accessToken}}

###

### Clustering institutionnel
GET {{baseUrlMain}}/attribution/clusters?sector=Technology
Authorization: Bearer {{accessToken}}

###
### üîç IDENTIFICATION RAPIDE
### - Si la route commence par /fmp/ ou /unusual-whales/ ‚Üí @baseUrlData
### - Sinon ‚Üí @baseUrlMain
###
### üìù INSTITUTIONS (Smart Money / Copy Trades)
### L'API Unusual Whales accepte √† la fois les noms d'institutions et les CIK.
### Pour certaines institutions, le CIK est plus fiable que le nom.
### 
### Exemples de CIK :
### - Berkshire Hathaway: 0001697748
### - BlackRock: 0001364742
### - Vanguard: 0000102909

### ============================================
### UNUSUAL WHALES - Institutions List
### ============================================

### GET /unusual-whales/institutions - Liste des institutions
### R√©cup√®re la liste des institutions avec tri par total_value (desc)
### Supporte limit jusqu'√† 1000
GET {{baseUrlData}}/unusual-whales/institutions?limit=1000&order=total_value&order_direction=desc
Authorization: Bearer {{accessToken}}

### GET /unusual-whales/institutions - Top 100 par total_value
GET {{baseUrlData}}/unusual-whales/institutions?limit=100&order=total_value&order_direction=desc
Authorization: Bearer {{accessToken}}

### GET /unusual-whales/institutions - Top 100 par total_value
### GET /unusual-whales/institutions - Recherche par nom
GET {{baseUrlData}}/unusual-whales/institutions?name=VANGUARD&limit=10
Authorization: Bearer {{accessToken}}
###
### Si une requ√™te avec un nom d'institution retourne une erreur 500,
### essayez d'utiliser le CIK √† la place.
###

### ============================================
### ü§ñ ANALYSE IA (AI Analyst)
### ============================================

### Analyser un calendrier d'√©v√©nements (FDA, Earnings, etc.)
### 100% DYNAMIQUE : Le backend r√©cup√®re automatiquement toutes les donn√©es depuis les APIs
### APIs invoqu√©es : Economic Calendar, FDA Calendar, Earnings Calendar
### P√©riode par d√©faut : 21 jours (si from/to non fournis)
POST {{baseUrlMain}}/ai/calendar-summary
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "from": "2025-12-09",
  "to": "2025-12-30"
}



###
### Analyser un flux d'options inhabituel (ENRICHI)
### 100% DYNAMIQUE : N√©cessite seulement { ticker }
### ‚ú® NOUVELLES FONCTIONNALIT√âS :
### - Open Interest changes (calls, puts, max OI strikes)
### - Implied Volatility (current, percentile, skew)
### - Volume Profile (par strike et par expiry)
### - Unusual Activity (sweeps, blocks, largest sweep)
### - Max Pain analysis (price distance)
### - Price Action (support/resistance, trend)
### - Upcoming Events (earnings, FDA)
### - Sc√©narios multiples (bullish/bearish/neutral) avec probabilit√©s
### - Recommandations avec strikes/expiries et risk level
### - Warnings (IV crush, max pain risk)
POST {{baseUrlMain}}/ai/options-flow-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

###
### Test Options Flow avec ticker diff√©rent
POST {{baseUrlMain}}/ai/options-flow-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA"
}

###
### Analyser les mouvements d'une institution (ENRICHI)
### 100% DYNAMIQUE : Le backend r√©cup√®re automatiquement toutes les donn√©es depuis les APIs
### ‚ú® NOUVELLES FONCTIONNALIT√âS :
### - Historique des positions (4 trimestres)
### - Performance des positions (P&L, entry price, holding period)
### - Concentration du portefeuille (top 10)
### - Sector Rotation detection
### - Style Analysis (growth/value/momentum/blend)
### - Market Context (SPY performance, sector performance)
### - Strategy Insight avec confidence
### - Performance Attribution (top performers, underperformers)
### - Copy Trade Opportunities avec entry strategies
### - Portfolio Analysis (concentration risk, sector bets)
POST {{baseUrlMain}}/ai/institution-moves-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "institution_cik": "0001364742",
  "institution_name": "BLACKROCK, INC.",
  "period": "3M"
}

###
### Test Institution Moves avec Vanguard
POST {{baseUrlMain}}/ai/institution-moves-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "institution_cik": "0000102909",
  "institution_name": "VANGUARD GROUP INC",
  "period": "3M"
}

### DARKP POOL TRADES
GET {{baseUrlData}}/unusual-whales/dark-pool/TSLA?limit=30
Authorization: Bearer {{accessToken}}

### DARKP POOL TRADES
GET {{baseUrlData}}/unusual-whales/dark-pool/recent
Authorization: Bearer {{accessToken}}
### ============================================
### TICKER ACTIVITY ANALYSIS - Endpoints S√©par√©s
### ============================================
### ‚ú® NOUVEAU : Cache int√©gr√© directement dans le service UW
### Les m√©thodes UW (getRecentFlows, getDarkPoolTrades, getShortInterestAndFloat)
### v√©rifient automatiquement le cache dans Supabase avant d'appeler l'API

### ‚úÖ Ticker Activity Analysis (BASE - Rapide)
### Analyse de base : Options Flow, Dark Pool, Insiders, Short Interest
### ‚ú® Cache int√©gr√© : Les donn√©es sont automatiquement mises en cache dans Supabase
### Temps estim√© : ~8-10 secondes (premi√®re fois), ~2-3 secondes (cache hit)
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json


{
  "ticker": "NVDA"
}

### ‚úÖ Ticker Activity Analysis - TSLA (test cache)
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA"
}

### ‚úÖ Ticker Activity Analysis - AAPL (test cache)
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "AAPL"
}

### ‚úÖ Ticker Options Analysis (ENRICHI - Options d√©taill√©es)
### Analyse approfondie des options : OI changes, IV, Greeks, Max Pain, Volume Profile
### Temps estim√© : ~10-12 secondes
POST {{baseUrlMain}}/ai/ticker-options-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### ‚úÖ Ticker Institutional Analysis (ENRICHI - Institutionnel)
### Analyse institutionnelle : Ownership, changements, patterns
### Temps estim√© : ~3-5 secondes
POST {{baseUrlMain}}/ai/ticker-institutional-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA"
}

### ‚úÖ Ticker News & Events Analysis (ENRICHI - News & Events)
### Analyse des news et √©v√©nements : Earnings, FDA, news sentiment
### Temps estim√© : ~4-6 secondes
POST {{baseUrlMain}}/ai/ticker-news-events-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "AVGO"
}

### üóëÔ∏è Invalider le cache pour un ticker (NVDA)
### ‚ö†Ô∏è Note : Le cache est maintenant g√©r√© dans Supabase (options_flow, dark_pool_trades, short_interest)
### Pour invalider manuellement, supprimez les entr√©es dans Supabase ou attendez l'expiration du TTL
DELETE {{baseUrlMain}}/ai/cache/invalidate/NVDA
Authorization: Bearer {{accessToken}}

### üóëÔ∏è Invalider le cache pour un ticker (AVGO)
DELETE {{baseUrlMain}}/ai/cache/invalidate/AVGO
Authorization: Bearer {{accessToken}}

### ============================================
### üèóÔ∏è ARCHITECTURE MODULAIRE - Tests d'Ingestion
### ============================================
### ‚ú® NOUVEAU : Architecture 3 couches (Collecte ‚Üí Analyses ‚Üí Synth√®se)
### 
### Routes d'ingestion disponibles :
### - POST /ingest/options-flow?ticker=NVDA : Ing√©rer options flow
### - POST /ingest/options-volume?ticker=NVDA : Ing√©rer options volume
### - POST /ingest/dark-pool?ticker=NVDA : Ing√©rer dark pool
### - POST /ingest/short-interest?ticker=NVDA : Ing√©rer short interest
### - POST /ingest/price-action?ticker=NVDA : Ing√©rer price action
### - POST /ingest/all?ticker=NVDA&modules=options_flow,dark_pool : Ing√©rer plusieurs modules
### - GET /ingest/status?ticker=NVDA : V√©rifier l'√©tat des modules
###
### ‚úÖ API Gateway 1 (Application Principale)

### Test Ingestion 1: V√©rifier l'√©tat des modules pour NVDA
### Devrait retourner l'√©tat de tous les modules (status, fetched_at, expires_at, refresh_lock_until)
GET {{baseUrlMain}}/ingest/status?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 2: Ing√©rer options flow pour NVDA
### Devrait :
### - V√©rifier shouldSkip() (skip si fresh ou refreshing avec lock valide)
### - Acqu√©rir un verrou atomique
### - Appeler l'API UW
### - Stocker dans options_flow (via TickerDataPersistenceService)
### - Finaliser avec finalizeModuleRefresh() (lib√®re lock + update status)
### - Utiliser TTL depuis analysis_catalog (pas hardcod√©)

### Test API UW flow-recent (pour v√©rifier la structure des donn√©es)
### Note: Les routes /unusual-whales/* sont sur l'API Gateway 2 (baseUrlData), pas baseUrlMain
GET {{baseUrlData}}/unusual-whales/stock/NVDA/flow-recent
Authorization: Bearer {{accessToken}}


### Test Ingestion 1: Ing√©rer options flow pour NVDA
POST {{baseUrlMain}}/ingest/options-flow?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Analyse: Analyser les donn√©es d'options flow stock√©es dans Supabase
### Lit depuis la base et fait une analyse IA
POST {{baseUrlMain}}/analyze/options-flow?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 3: Ing√©rer options volume pour NVDA
### Devrait stocker dans la table d√©di√©e options_volume (data_date NOT NULL)
POST {{baseUrlMain}}/ingest/options-volume?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 4: Ing√©rer dark pool pour NVDA
POST {{baseUrlMain}}/ingest/dark-pool?ticker=NVDA&limit=30
Authorization: Bearer {{accessToken}}

### Test Ingestion 5: Ing√©rer short interest pour NVDA
POST {{baseUrlMain}}/ingest/short-interest?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 6: Ing√©rer price action pour NVDA
POST {{baseUrlMain}}/ingest/price-action?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 6c: Ing√©rer price context (SMA20/50 + range 5j) pour NVDA
POST {{baseUrlMain}}/ingest/price-context?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 6b: Ing√©rer earnings historiques pour NVDA
POST {{baseUrlMain}}/ingest/earnings?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test INgestion greek
POST {{baseUrlMain}}/ingest/greeks?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 7: Ing√©rer plusieurs modules en parall√®le pour NVDA
### Devrait ing√©rer options_flow, dark_pool, short_interest, price_action, price_context, earnings en parall√®le
POST {{baseUrlMain}}/ingest/all?ticker=NVDA&modules=options_flow,dark_pool,short_interest,price_action,price_context,earnings
Authorization: Bearer {{accessToken}}

### Test Ingestion 8: V√©rifier l'√©tat apr√®s ingestion
### Devrait montrer status='ready' pour les modules ing√©r√©s
GET {{baseUrlMain}}/ingest/status?ticker=NVDA
Authorization: Bearer {{accessToken}}

### Test Ingestion 9: Test "skip if fresh" - R√©ing√©rer imm√©diatement
### Devrait skip l'ingestion (shouldSkip() retourne true car fresh)
### V√©rifier dans les logs : "Skipping ingestion (fresh or refreshing)"
POST {{baseUrlMain}}/ingest/options-flow?ticker=NVDA&limit=30
Authorization: Bearer {{accessToken}}

### Test Ingestion 10: Test verrous atomiques - Requ√™tes concurrentes
### Faire 3 requ√™tes simultan√©es pour le m√™me module
### Seule la premi√®re devrait acqu√©rir le lock, les autres devraient skip
### V√©rifier dans les logs : "Refresh lock already held, skipping ingestion"
POST {{baseUrlMain}}/ingest/options-flow?ticker=TSLA&limit=30
Authorization: Bearer {{accessToken}}

POST {{baseUrlMain}}/ingest/options-flow?ticker=TSLA&limit=30
Authorization: Bearer {{accessToken}}

POST {{baseUrlMain}}/ingest/options-flow?ticker=TSLA&limit=30
Authorization: Bearer {{accessToken}}
### Test Spot Exposures By Strike And Expiry
GET {{baseUrlData}}/unusual-whales/stock/TSLA/spot-exposures/strike
Authorization: Bearer {{accessToken}}
### Test Spot Exposures By Strike
GET {{baseUrlData}}/unusual-whales/stock/TSLA/spot-exposures/expiry-strike
Authorization: Bearer {{accessToken}}

### ============================================
### TESTS CACHE INT√âGR√â - Service UW
### ============================================
### ‚ú® Tests pour v√©rifier que le cache fonctionne correctement
### Le cache est maintenant int√©gr√© directement dans les m√©thodes UW
### 
### ‚ö†Ô∏è IMPORTANT : Avec la nouvelle architecture modulaire, le cache est g√©r√© via :
### - ticker_data_modules (√©tat des modules : status, fetched_at, expires_at)
### - options_flow, dark_pool_trades, short_interest (donn√©es brutes)
### - analysis_catalog (TTL dynamiques par module)

### Test 1: Recent Flows avec cache (premi√®re requ√™te = API, deuxi√®me = cache)
### Premi√®re requ√™te : devrait appeler l'API et stocker dans options_flow
GET {{baseUrlData}}/unusual-whales/stock/NVDA/flow-recent?limit=30
Authorization: Bearer {{accessToken}}

### Deuxi√®me requ√™te (imm√©diatement apr√®s) : devrait utiliser le cache
GET {{baseUrlData}}/unusual-whales/stock/NVDA/flow-recent?limit=30
Authorization: Bearer {{accessToken}}

### Test 2: Dark Pool avec cache
### Premi√®re requ√™te : devrait appeler l'API et stocker dans dark_pool_trades
GET {{baseUrlData}}/unusual-whales/dark-pool/NVDA?limit=30
Authorization: Bearer {{accessToken}}

### Deuxi√®me requ√™te : devrait utiliser le cache
GET {{baseUrlData}}/unusual-whales/dark-pool/NVDA?limit=30
Authorization: Bearer {{accessToken}}

### Test 3: Short Interest avec cache
### Premi√®re requ√™te : devrait appeler l'API et stocker dans short_interest
GET {{baseUrlData}}/unusual-whales/shorts/NVDA/interest-float
Authorization: Bearer {{accessToken}}

### Deuxi√®me requ√™te : devrait utiliser le cache
GET {{baseUrlData}}/unusual-whales/shorts/NVDA/interest-float
Authorization: Bearer {{accessToken}}

### Test 4: Ticker Activity Analysis avec cache int√©gr√©
### Premi√®re requ√™te : devrait appeler les APIs et stocker dans Supabase
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### Deuxi√®me requ√™te (imm√©diatement apr√®s) : devrait utiliser le cache pour options_flow, dark_pool, short_interest
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### Test 5: Comparaison avec Options Flow Analysis (qui appelle directement l'API)
### Cette route devrait aussi b√©n√©ficier du cache maintenant
POST {{baseUrlMain}}/ai/options-flow-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### Test 6: V√©rifier que le cache fonctionne pour plusieurs tickers
### TSLA - Premi√®re requ√™te (devrait appeler l'API)
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA"
}

### Test FMP SEC Filings Profile

GET {{baseUrlData}}/fmp/sec-filings/profile/TSLA
Authorization: Bearer {{accessToken}}

### Test FMP SEC Filings Profile
GET {{baseUrlData}}/fmp/quote/TSLA
Authorization: Bearer {{accessToken}}

### Test FMP Grades
GET {{baseUrlData}}/fmp/grades/TSLA
Authorization: Bearer {{accessToken}}

### Test FMP Grades Historical

GET {{baseUrlData}}/fmp/grades-historical/TSLA?limit=100
Authorization: Bearer {{accessToken}}

### Test FMP Grades Consensus
GET {{baseUrlData}}/fmp/grades-consensus/TSLA
Authorization: Bearer {{accessToken}}

### /fmp/insider-trading/latest
GET {{baseUrlData}}/fmp/insider-trading/latest
Authorization: Bearer {{accessToken}}

### Test FMP Grades Consensus
GET {{baseUrlData}}/fmp/price-target-consensus/TSLA
Authorization: Bearer {{accessToken}}

### Test FMP Signals
GET https://nmynjtrppwhiwlxfdzdh.supabase.co/rest/v1/fmp_signals?select=*&order=timestamp.desc&limit=10&ticker=TSLA
Authorization: Bearer {{accessToken}}


### TSLA - Deuxi√®me requ√™te (devrait utiliser le cache)
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA"
}

### Test 7: V√©rifier les r√©ponses contiennent l'indicateur "cached"
### Les r√©ponses des m√©thodes UW devraient maintenant inclure "cached: true" si depuis le cache
### V√©rifier dans la r√©ponse : { "success": true, "cached": true, ... }
GET {{baseUrlData}}/unusual-whales/stock/NVDA/flow-recent?limit=30
Authorization: Bearer {{accessToken}}

### ============================================
### üß™ TESTS ARCHITECTURE MODULAIRE - Validation
### ============================================
### Tests pour valider la nouvelle architecture 3 couches
### 
### ‚úÖ CORRECTIONS APPLIQU√âES :
### - Lock atomique (acquire_refresh_lock)
### - Skip if fresh + refreshing_effective
### - finalize_module_refresh (1 transaction)
### - options_volume data_date NOT NULL
### - get_or_create_job simplifi√©
### - TTL depuis analysis_catalog (pas hardcod√©s)
### - shouldSkip() v√©rifie refresh_lock_until
### - unit_analyses UNIQUE avec contraintes partielles
### 
### Objectifs des tests :
### 1. V√©rifier que les routes d'analyse utilisent le cache modulaire
### 2. V√©rifier que les TTL sont respect√©s (via analysis_catalog)
### 3. V√©rifier que les verrous fonctionnent (pas de cache stampede)
### 4. V√©rifier que shouldSkip() fonctionne (fresh/refreshing)
### 5. V√©rifier que finalizeModuleRefresh() lib√®re les locks
### 6. V√©rifier que les timeouts sont √©vit√©s

### Test Architecture 1: Ticker Activity Analysis (utilise le nouveau syst√®me)
### Cette route devrait maintenant :
### - V√©rifier l'√©tat des modules via ticker_data_modules
### - Utiliser shouldSkip() pour √©viter les refetch inutiles
### - Lire les TTL depuis analysis_catalog (pas hardcod√©s)
### - G√©rer les verrous atomiques pour √©viter cache stampede
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### Test Architecture 2: V√©rifier que le cache est utilis√© (2√®me requ√™te imm√©diate)
### Devrait retourner rapidement (cache hit) avec "cached: true"
### V√©rifier dans les logs CloudWatch : "Skipping ingestion (fresh or refreshing)"
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### Test Architecture 3: Options Flow Analysis (doit aussi utiliser le syst√®me modulaire)
### V√©rifier que cette route b√©n√©ficie du cache modulaire
POST {{baseUrlMain}}/ai/options-flow-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "TSLA"
}

### Test Architecture 4: Institution Moves Analysis (doit respecter les timeouts)
### Cette route devrait maintenant √™tre optimis√©e pour √©viter les timeouts
### V√©rifier que la r√©ponse arrive en < 20s
POST {{baseUrlMain}}/ai/institution-moves-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "institution_cik": "0001364742",
  "institution_name": "BLACKROCK, INC.",
  "period": "3M"
}

### Test Architecture 5: V√©rifier les donn√©es UW avec cache int√©gr√©
### Ces routes utilisent maintenant le cache via UnusualWhalesService
### Premi√®re requ√™te : API call + stockage dans Supabase
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-recent?limit=30
Authorization: Bearer {{accessToken}}

### Deuxi√®me requ√™te : Cache hit (devrait √™tre rapide)
GET {{baseUrlData}}/unusual-whales/stock/AAPL/flow-recent?limit=30
Authorization: Bearer {{accessToken}}

### Test Architecture 6: Dark Pool avec cache modulaire
### Premi√®re requ√™te : API call
GET {{baseUrlData}}/unusual-whales/dark-pool/AAPL?limit=30
Authorization: Bearer {{accessToken}}

### Deuxi√®me requ√™te : Cache hit
GET {{baseUrlData}}/unusual-whales/dark-pool/AAPL?limit=30
Authorization: Bearer {{accessToken}}

### Test Architecture 7: Short Interest avec cache modulaire
### Premi√®re requ√™te : API call
GET {{baseUrlData}}/unusual-whales/shorts/AAPL/interest-float
Authorization: Bearer {{accessToken}}

### Deuxi√®me requ√™te : Cache hit
GET {{baseUrlData}}/unusual-whales/shorts/AAPL/interest-float
Authorization: Bearer {{accessToken}}
### Test Spot Exposures By Strike And Expiry
GET {{baseUrlData}}/unusual-whales/stock/TSLA/options-volume
Authorization: Bearer {{accessToken}}
### alert pour test
GET {{baseUrlData}}/unusual-whales/alerts?ticker=TSLA
Authorization: Bearer {{accessToken}}
### ============================================
### üìä VALIDATION DES CORRECTIONS PROD
### ============================================
### Tests pour valider les corrections critiques appliqu√©es :
### 
### ‚úÖ FIX #1: unit_analyses UNIQUE avec data_date NULL (contraintes partielles)
### ‚úÖ FIX #2: refreshing_effective (lock valide uniquement)
### ‚úÖ FIX #3: acquire_refresh_lock g√®re les locks expir√©s
### ‚úÖ FIX #4: options_volume date supprim√©e (garder data_date)
### ‚úÖ FIX #5: Index expires_at ajout√©s
### ‚úÖ FIX #6: TTL depuis analysis_catalog (pas hardcod√©s)
### ‚úÖ FIX #7: shouldSkip() v√©rifie refresh_lock_until

### Test Validation 1: Ticker Activity Analysis avec donn√©es compl√®tes
### V√©rifier que toutes les donn√©es sont pr√©sentes (pas de "missing data")
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

### Test Validation 2: V√©rifier que les timeouts sont respect√©s
### Institution Moves Analysis ne devrait plus timeout apr√®s 20s
POST {{baseUrlMain}}/ai/institution-moves-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "institution_cik": "0000102909",
  "institution_name": "VANGUARD GROUP INC",
  "period": "3M"
}

### Test Validation 3: V√©rifier que le cache invalidation fonctionne
### Apr√®s invalidation, la prochaine requ√™te devrait refetch
DELETE {{baseUrlMain}}/ai/cache/invalidate/NVDA
Authorization: Bearer {{accessToken}}

### Puis refaire une requ√™te (devrait refetch)
POST {{baseUrlMain}}/ai/ticker-activity-analysis
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "ticker": "NVDA"
}

###

# ============================================
# FINANCIAL JUICE - Analyse de Nouvelles avec OpenAI
# ============================================

### POST /ai/financial-juice/analyze - Analyser un headline Financial Juice (Taux d'int√©r√™t)
POST {{baseUrlMain}}/ai/financial-juice/analyze
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "headline": {
    "title": "BREAKING: Fed raises interest rates by 0.25%",
    "description": "Federal Reserve announces rate hike, markets react",
    "timestamp": "2025-12-08T14:30:00Z",
    "category": "Monetary Policy",
    "tickers": []
  }
}

### POST /ai/financial-juice/analyze - Analyser un headline avec ticker (Earnings)
POST {{baseUrlMain}}/ai/financial-juice/analyze
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "headline": {
    "title": "AAPL earnings beat expectations, stock up 5%",
    "description": "Apple reports strong Q4 earnings, beats estimates",
    "timestamp": "2025-12-08T16:00:00Z",
    "category": "Earnings",
    "tickers": ["AAPL"]
  }
}

### POST /ai/financial-juice/analyze - Analyser un headline g√©opolitique (OPEC)
POST {{baseUrlMain}}/ai/financial-juice/analyze
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "headline": {
    "title": "OPEC announces production cut, oil prices surge",
    "description": "OPEC+ agrees to cut production by 2M barrels per day",
    "timestamp": "2025-12-08T10:00:00Z",
    "category": "Commodity",
    "tickers": []
  }
}

### GET /ai/financial-juice/latest - R√©cup√©rer et analyser les derni√®res nouvelles (10 par d√©faut)
GET {{baseUrlMain}}/ai/financial-juice/latest
Authorization: Bearer {{accessToken}}

### GET /ai/financial-juice/latest - R√©cup√©rer et analyser les 20 derni√®res nouvelles
GET {{baseUrlMain}}/ai/financial-juice/latest?limit=20
Authorization: Bearer {{accessToken}}

###

